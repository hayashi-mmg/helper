# タスク削除APIテストシナリオ

## エンドポイント
`DELETE /api/v1/tasks/{task_id}`

## 概要
このテストシナリオでは、タスク削除APIの機能を検証します。既存のタスクを削除する機能のテストケースを定義します。

## 前提条件
- テストユーザーが存在している
- テストユーザーに関連するタスクが存在している
- 管理者ユーザーが存在している
- 別のユーザーとそのタスクも存在している

## テストケース

### TC-001: 正常系 - 自分のタスクを削除
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 自分のタスクのID

**期待結果**
- ステータスコード: 200 OK または 204 No Content
- レスポンスボディ: 削除成功のメッセージまたは空
- データベースからタスクが削除されていること

### TC-002: 正常系 - 管理者が他のユーザーのタスクを削除
**入力**
- リクエストヘッダー: 有効な管理者アクセストークン
- URLパラメータ: 他のユーザーのタスクのID

**期待結果**
- ステータスコード: 200 OK または 204 No Content
- レスポンスボディ: 削除成功のメッセージまたは空
- データベースからタスクが削除されていること

### TC-003: 異常系 - 存在しないタスクID
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 存在しないタスクID（例: 9999）

**期待結果**
- ステータスコード: 404 Not Found
- エラーメッセージ: タスクが存在しないことを示すメッセージ

### TC-004: 異常系 - 他のユーザーのタスクを削除しようとする
**入力**
- リクエストヘッダー: 一般ユーザーのアクセストークン
- URLパラメータ: 他のユーザーのタスクのID

**期待結果**
- ステータスコード: 403 Forbidden
- エラーメッセージ: アクセス権限がないことを示すメッセージ
- データベース内のタスクが削除されていないこと

### TC-005: 異常系 - 未認証アクセス
**入力**
- リクエストヘッダー: アクセストークンなし
- URLパラメータ: 有効なタスクID

**期待結果**
- ステータスコード: 401 Unauthorized
- エラーメッセージ: 認証が必要であることを示すメッセージ
- データベース内のタスクが削除されていないこと

### TC-006: 異常系 - 無効なタスクID形式
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 無効な形式のタスクID（例: "abc"）

**期待結果**
- ステータスコード: 422 Unprocessable Entity
- エラーメッセージ: タスクIDの形式が無効であることを示すメッセージ

### TC-007: 正常系 - すでに完了(completed)状態のタスクを削除
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 自分の完了済みタスクのID

**期待結果**
- ステータスコード: 200 OK または 204 No Content
- レスポンスボディ: 削除成功のメッセージまたは空
- データベースからタスクが削除されていること

### TC-008: 正常系 - 進行中(in_progress)状態のタスクを削除
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 自分の進行中タスクのID

**期待結果**
- ステータスコード: 200 OK または 204 No Content
- レスポンスボディ: 削除成功のメッセージまたは空
- データベースからタスクが削除されていること

## モック設定
- データベースに複数のユーザーとタスクのレコードを事前に用意
- タスク削除のデータベース処理をモック化
- 異なるユーザーに属するタスクを含める
- 異なるステータス（requested, in_progress, completed, cancelled）のタスクを含める

## 検証項目
- タスクが正しく削除されること
- タスク削除後のデータベース状態の確認
- 認証の検証
- 認可（アクセス権限）の検証
- 存在しないリソースへのアクセス時の適切なエラーハンドリング
- 無効なIDパラメータのハンドリング
- 削除結果の一貫性（冪等性）の確認
