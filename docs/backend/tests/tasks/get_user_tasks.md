# ユーザーのタスク一覧取得APIテストシナリオ

## エンドポイント
`GET /api/v1/users/{user_id}/tasks`

## 概要
このテストシナリオでは、特定のユーザーに関連するタスク一覧を取得するAPIの機能を検証します。ユーザーIDを指定して、そのユーザーのタスク一覧を取得する機能をテストします。

## 前提条件
- テストユーザーが存在している
- テストユーザーに関連する複数のタスクが存在している
- 別のユーザーとそのタスクも存在している
- ヘルパーユーザーが存在している
- 管理者ユーザーが存在している
- ユーザー・ヘルパーの割り当て関係が設定されている

## テストケース

### TC-001: 正常系 - ユーザーが自分のタスク一覧を取得
**入力**
- リクエストヘッダー: 有効なユーザーアクセストークン
- URLパラメータ: 自分のユーザーID

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: ユーザーのタスク一覧（配列）
- 各タスクが正しいプロパティ（id, title, description, status等）を持つ

### TC-002: 正常系 - ヘルパーが担当ユーザーのタスク一覧を取得
**入力**
- リクエストヘッダー: 有効なヘルパーアクセストークン
- URLパラメータ: 担当ユーザーのID

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: 指定したユーザーのタスク一覧（配列）

### TC-003: 正常系 - 管理者が任意のユーザーのタスク一覧を取得
**入力**
- リクエストヘッダー: 有効な管理者アクセストークン
- URLパラメータ: 任意のユーザーID

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: 指定したユーザーのタスク一覧（配列）

### TC-004: 正常系 - クエリパラメータによるフィルタリング
**入力**
- リクエストヘッダー: 有効なユーザーアクセストークン
- URLパラメータ: 自分のユーザーID
- クエリパラメータ: `status=requested`

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: statusが"requested"のタスクのみが含まれる

### TC-005: 正常系 - ページネーション
**入力**
- リクエストヘッダー: 有効なユーザーアクセストークン
- URLパラメータ: 自分のユーザーID
- クエリパラメータ: `skip=0&limit=5`

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: 最大5件のタスクが返される

### TC-006: 異常系 - 他のユーザーのタスク一覧をヘルパー以外が取得
**入力**
- リクエストヘッダー: 有効な一般ユーザーアクセストークン
- URLパラメータ: 他のユーザーのID

**期待結果**
- ステータスコード: 403 Forbidden
- エラーメッセージ: アクセス権限がないことを示すメッセージ

### TC-007: 異常系 - 存在しないユーザーID
**入力**
- リクエストヘッダー: 有効な管理者アクセストークン
- URLパラメータ: 存在しないユーザーID（例: 9999）

**期待結果**
- ステータスコード: 404 Not Found
- エラーメッセージ: ユーザーが存在しないことを示すメッセージ

### TC-008: 異常系 - 担当していないユーザーのタスク一覧をヘルパーが取得
**入力**
- リクエストヘッダー: 有効なヘルパーアクセストークン
- URLパラメータ: 担当外のユーザーID

**期待結果**
- ステータスコード: 403 Forbidden
- エラーメッセージ: アクセス権限がないことを示すメッセージ

### TC-009: 正常系 - タスクがない場合
**入力**
- リクエストヘッダー: 有効なユーザーアクセストークン
- URLパラメータ: タスクが存在しないユーザーのID（管理者の場合）または自分のID（タスクを持たないユーザーの場合）

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: 空の配列 `[]`

### TC-010: 異常系 - 未認証アクセス
**入力**
- リクエストヘッダー: アクセストークンなし
- URLパラメータ: 有効なユーザーID

**期待結果**
- ステータスコード: 401 Unauthorized
- エラーメッセージ: 認証が必要であることを示すメッセージ

### TC-011: 正常系 - 日付による絞り込み
**入力**
- リクエストヘッダー: 有効なユーザーアクセストークン
- URLパラメータ: 自分のユーザーID
- クエリパラメータ: `scheduled_date=2025-06-01`

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: 予定日が2025-06-01のタスクのみが含まれる

### TC-012: 正常系 - 優先度による絞り込み
**入力**
- リクエストヘッダー: 有効なユーザーアクセストークン
- URLパラメータ: 自分のユーザーID
- クエリパラメータ: `priority=5`

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: 優先度が5のタスクのみが含まれる

### TC-013: 正常系 - カテゴリによる絞り込み
**入力**
- リクエストヘッダー: 有効なユーザーアクセストークン
- URLパラメータ: 自分のユーザーID
- クエリパラメータ: `category=掃除`

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: カテゴリが"掃除"のタスクのみが含まれる

## モック設定
- データベースに複数のユーザー、ヘルパー、タスクのレコードを事前に用意
- ユーザー・ヘルパー割り当て関係を設定
- 異なるステータス、優先度、カテゴリ、予定日のタスクを含める

## 検証項目
- 正しいユーザーのタスク一覧が取得できること
- フィルタリングの正しい動作
- ページネーションの正しい動作
- 認証の検証
- 認可（アクセス権限）の検証
- 存在しないユーザーへのアクセス時の適切なエラーハンドリング
- 空結果の適切な処理
