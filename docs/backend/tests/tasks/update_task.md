# タスク更新APIテストシナリオ

## エンドポイント
`PUT /api/v1/tasks/{task_id}`

## 概要
このテストシナリオでは、タスク更新APIの機能を検証します。既存のタスクの情報を更新する機能のテストケースを定義します。

## 前提条件
- テストユーザーが存在している
- テストユーザーに関連するタスクが存在している
- 管理者ユーザーが存在している
- 別のユーザーとそのタスクも存在している

## テストケース

### TC-001: 正常系 - 自分のタスクの一部フィールドを更新
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 自分のタスクのID
- リクエストボディ:
```json
{
    "title": "更新されたタスクタイトル",
    "priority": 3
}
```

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: 更新されたタスク情報
  - title: "更新されたタスクタイトル"
  - priority: 3
  - 他のフィールドは元の値を維持

### TC-002: 正常系 - 自分のタスクのすべてのフィールドを更新
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 自分のタスクのID
- リクエストボディ:
```json
{
    "title": "完全に更新されたタスク",
    "description": "新しい説明文",
    "category": "新しいカテゴリ",
    "priority": 5,
    "scheduled_date": "2025-07-15"
}
```

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: すべてのフィールドが更新されたタスク情報
- updated_at: 更新日時が現在の時刻に更新されている

### TC-003: 正常系 - 管理者が他のユーザーのタスクを更新
**入力**
- リクエストヘッダー: 有効な管理者アクセストークン
- URLパラメータ: 他のユーザーのタスクのID
- リクエストボディ: 有効な更新データ

**期待結果**
- ステータスコード: 200 OK
- レスポンスボディ: 更新されたタスク情報

### TC-004: 異常系 - 存在しないタスクID
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 存在しないタスクID（例: 9999）
- リクエストボディ: 有効な更新データ

**期待結果**
- ステータスコード: 404 Not Found
- エラーメッセージ: タスクが存在しないことを示すメッセージ

### TC-005: 異常系 - 他のユーザーのタスクを更新しようとする
**入力**
- リクエストヘッダー: 一般ユーザーのアクセストークン
- URLパラメータ: 他のユーザーのタスクのID
- リクエストボディ: 有効な更新データ

**期待結果**
- ステータスコード: 403 Forbidden
- エラーメッセージ: アクセス権限がないことを示すメッセージ

### TC-006: 異常系 - 無効なフィールド値
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 自分のタスクのID
- リクエストボディ:
```json
{
    "priority": 100
}
```

**期待結果**
- ステータスコード: 422 Unprocessable Entity
- エラーメッセージ: フィールド値が無効であることを示すメッセージ

### TC-007: 異常系 - 無効な日付形式
**入力**
- リクエストヘッダー: 有効なアクセストークン
- URLパラメータ: 自分のタスクのID
- リクエストボディ:
```json
{
    "scheduled_date": "無効な日付"
}
```

**期待結果**
- ステータスコード: 422 Unprocessable Entity
- エラーメッセージ: 日付形式が無効であることを示すメッセージ

### TC-008: 異常系 - 未認証アクセス
**入力**
- リクエストヘッダー: アクセストークンなし
- URLパラメータ: 有効なタスクID
- リクエストボディ: 有効な更新データ

**期待結果**
- ステータスコード: 401 Unauthorized
- エラーメッセージ: 認証が必要であることを示すメッセージ

## モック設定
- データベースに複数のユーザーとタスクのレコードを事前に用意
- タスク更新のデータベース処理をモック化
- 異なるユーザーに属するタスクを含める

## 検証項目
- 正しくタスクが更新されること
- 一部フィールドのみの更新が可能なこと
- 未指定のフィールドが変更されないこと
- updated_at フィールドが自動更新されること
- 認証の検証
- 認可（アクセス権限）の検証
- バリデーションの確認
- エラーハンドリングの適切さ
